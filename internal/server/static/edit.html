<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Edit Sentences</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			background-color: #f5f5f5;
			color: #333;
			margin: 0;
			padding: 20px;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
		}

		.status-bar {
			width: 100%;
			background-color: #007bff;
			color: white;
			padding: 10px 0;
			text-align: center;
			position: fixed;
			top: 0;
			left: 0;
			display: flex;
			align-items: center;
			justify-content: space-between;
			z-index: 1000;
		}

		.status-bar .back-button {
			background: none;
			border: none;
			color: white;
			font-size: 1.2em;
			cursor: pointer;
			padding: 10px;
		}

		.status-bar .title {
			flex: 1;
			text-align: center;
			font-size: 1.5em;
		}

		.container {
			background-color: #fff;
			border: 1px solid #ddd;
			border-radius: 8px;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
			padding: 20px;
			width: 90%;
			max-width: 1000px;
			margin-bottom: 20px;
			margin-top: 70px;
		}

		.page-selector {
			margin-bottom: 20px;
			padding: 15px;
			background-color: #f8f9fa;
			border-radius: 5px;
			border: 1px solid #dee2e6;
		}

		.page-selector label {
			font-weight: bold;
			margin-right: 10px;
		}

		.page-selector select {
			padding: 8px 12px;
			border: 1px solid #ced4da;
			border-radius: 4px;
			font-size: 16px;
			background-color: white;
		}

		.page-content {
			display: flex;
			gap: 15px;
			margin-bottom: 15px;
		}

		.page-wrapper {
			background-color: #fff;
			border: 1px solid #ddd;
			border-radius: 6px;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			padding: 15px;
			margin-bottom: 20px;
		}

		.page-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 15px;
			padding-bottom: 10px;
			border-bottom: 1px solid #007bff;
		}

		.page-title {
			font-size: 1.2em;
			font-weight: bold;
			color: #007bff;
		}

		.page-footer {
			display: flex;
			justify-content: center;
			gap: 15px;
			margin-top: 15px;
			padding-top: 15px;
			border-top: 1px solid #dee2e6;
		}

		.page-image {
			flex: 0 0 35%;
			max-width: 300px;
		}

		.page-image img {
			width: 100%;
			height: auto;
			border-radius: 4px;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
		}

		.sentences-container {
			flex: 1;
		}

		.sentence-item {
			background-color: #f8f9fa;
			border: 1px solid #dee2e6;
			border-radius: 6px;
			padding: 10px;
			margin-bottom: 10px;
			transition: all 0.2s ease;
		}

		.sentence-item:hover {
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
		}


		.sentence-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 8px;
		}

		.sentence-number {
			font-weight: bold;
			color: #007bff;
			margin-right: 10px;
		}

		.sentence-actions {
			margin-left: auto;
		}

		.btn {
			padding: 4px 8px;
			border: none;
			border-radius: 3px;
			cursor: pointer;
			font-size: 12px;
			margin-left: 5px;
			transition: all 0.2s ease;
		}

		.btn-primary {
			background-color: #007bff;
			color: white;
		}

		.btn-primary:hover {
			background-color: #0056b3;
		}

		.btn-success {
			background-color: #28a745;
			color: white;
		}

		.btn-success:hover {
			background-color: #218838;
		}

		.btn-secondary {
			background-color: #6c757d;
			color: white;
		}

		.btn-secondary:hover {
			background-color: #545b62;
		}

		.btn-danger {
			background-color: #dc3545;
			color: white;
		}

		.btn-danger:hover {
			background-color: #c82333;
		}

		.sentence-content {
			margin-bottom: 8px;
		}

		.sentence-content textarea {
			width: 100%;
			padding: 6px 10px;
			border: 1px solid #ced4da;
			border-radius: 4px;
			font-size: 14px;
			font-family: inherit;
			resize: vertical;
			min-height: 35px;
			max-height: 80px;
		}

		.sentence-content textarea:focus {
			outline: none;
			border-color: #007bff;
			box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
		}

		.sentence-translate {
			margin-bottom: 10px;
		}

		.sentence-translate textarea {
			width: 100%;
			padding: 8px 12px;
			border: 1px solid #ced4da;
			border-radius: 4px;
			font-size: 14px;
			font-family: inherit;
			resize: vertical;
			min-height: 40px;
		}

		.sentence-translate textarea:focus {
			outline: none;
			border-color: #007bff;
			box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
		}

		.sentence-audio {
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.play-btn {
			min-width: 60px;
		}

		.play-btn:hover {
			transform: scale(1.05);
		}

		.sentence-audio audio {
			flex: 1;
		}

		.audio-info {
			font-size: 12px;
			color: #6c757d;
			white-space: nowrap;
		}

		.sentence-timing {
			display: flex;
			gap: 15px;
			margin-bottom: 8px;
		}

		.timing-input {
			display: flex;
			flex-direction: column;
			gap: 5px;
		}

		.timing-input label {
			font-size: 12px;
			font-weight: bold;
			color: #495057;
		}

		.timing-input input {
			padding: 6px 8px;
			border: 1px solid #ced4da;
			border-radius: 4px;
			font-size: 14px;
			width: 80px;
		}

		.timing-input input:focus {
			outline: none;
			border-color: #007bff;
			box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
		}

		.add-sentence-btn {
			background-color: #28a745;
			color: white;
			border: none;
			padding: 8px 16px;
			border-radius: 4px;
			font-size: 14px;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		.add-sentence-btn:hover {
			background-color: #218838;
		}

		.save-all-container {
			position: fixed;
			bottom: 20px;
			right: 20px;
			z-index: 1000;
			display: flex;
			gap: 10px;
			align-items: center;
		}

		.save-all-btn {
			background-color: #007bff;
			color: white;
			border: none;
			padding: 8px 16px;
			border-radius: 4px;
			font-size: 14px;
			font-weight: bold;
			cursor: pointer;
			box-shadow: 0 2px 4px rgba(0, 123, 255, 0.3);
			transition: all 0.2s ease;
		}

		.save-all-btn:hover {
			background-color: #0056b3;
			transform: translateY(-1px);
			box-shadow: 0 3px 8px rgba(0, 123, 255, 0.4);
		}

		.save-all-btn:disabled {
			background-color: #6c757d;
			cursor: not-allowed;
			transform: none;
			box-shadow: none;
			opacity: 0.6;
		}

		.loading {
			display: none;
			text-align: center;
			padding: 20px;
			color: #6c757d;
		}

		.loading.show {
			display: block;
		}

		.error-message {
			background-color: #f8d7da;
			color: #721c24;
			padding: 10px;
			border-radius: 4px;
			margin-bottom: 15px;
			border: 1px solid #f5c6cb;
		}

		.success-message {
			background-color: #d4edda;
			color: #155724;
			padding: 15px 20px;
			border-radius: 6px;
			margin-bottom: 15px;
			border: 2px solid #28a745;
			font-weight: bold;
			font-size: 16px;
			box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
			animation: successPulse 0.5s ease-in-out;
		}

		@keyframes successPulse {
			0% {
				transform: scale(1);
			}

			50% {
				transform: scale(1.05);
			}

			100% {
				transform: scale(1);
			}
		}

		@media (max-width: 768px) {
			.page-content {
				flex-direction: column;
			}

			.page-image {
				flex: none;
				max-width: 100%;
			}
		}
	</style>
</head>

<body>
	<div class="status-bar">
		<button class="back-button" onclick="goBack()">⟵ Back</button>
		<div class="title" id="book-title">Edit Sentences</div>
		<div class="back-button"></div>
	</div>

	<div class="container">
		<div class="loading" id="loading">Loading book data...</div>

		<div id="error-container"></div>
		<div id="success-container"></div>

		<div id="book-content" style="display: none;">
			<div id="all-pages-container">
				<!-- All pages will be populated dynamically -->
			</div>
		</div>
	</div>


	<script>
		let bookData = null;
		let hasUnsavedChanges = {};
		let originalSentences = {};
		let bookId = null;
		let savedPagesCount = 0;

		// Initialize the application
		function initializeApp() {
			// Get book ID from URL parameters
			const urlParams = new URLSearchParams(window.location.search);
			bookId = urlParams.get('id');
			const pageId = urlParams.get('page');

			if (!bookId) {
				showError('Book ID is required');
				return;
			}

			// Load book data
			loadBook(bookId, pageId);
		}

		// Load book data
		async function loadBook(bookId, pageId) {
			try {
				showLoading(true);
				const response = await fetch(`/api/book/${bookId}`);
				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}
				bookData = await response.json();

				if (!bookData.pages || bookData.pages.length === 0) {
					throw new Error('No pages found in book');
				}

				document.getElementById('book-title').textContent = `Edit: ${bookData.title}`;

				// Initialize unsaved changes tracking for all pages
				bookData.pages.forEach((page, index) => {
					hasUnsavedChanges[index] = false;
					originalSentences[index] = JSON.parse(JSON.stringify(page.sentences || []));
				});

				displayAllPages();
				showLoading(false);
				document.getElementById('book-content').style.display = 'block';

			} catch (error) {
				console.error('Error loading book:', error);
				showError(`Failed to load book: ${error.message}`);
				showLoading(false);
			}
		}

		function displayAllPages() {
			const container = document.getElementById('all-pages-container');
			container.innerHTML = '';

			bookData.pages.forEach((page, pageIndex) => {
				const pageWrapper = document.createElement('div');
				pageWrapper.className = 'page-wrapper';
				pageWrapper.innerHTML = `
					<div class="page-header">
						<div class="page-title">Page ${pageIndex + 1}</div>
					</div>
					<div class="page-content">
						<div class="page-image">
							<img src="/assets/${page.image_url}" alt="Page ${pageIndex + 1}">
						</div>
						<div class="sentences-container" id="sentences-container-${pageIndex}">
							<!-- Sentences will be populated dynamically -->
						</div>
					</div>
					<div class="page-footer">
						<button class="add-sentence-btn" onclick="addNewSentence(${pageIndex})">+ Add Sentence</button>
						<button class="save-all-btn" id="save-btn-${pageIndex}" onclick="savePageChanges(${pageIndex})">
							Save Changes
						</button>
					</div>
				`;
				container.appendChild(pageWrapper);

				// Populate sentences for this page
				populateSentencesForPage(page.sentences || [], pageIndex);
			});
		}


		function populateSentencesForPage(sentences, pageIndex) {
			const container = document.getElementById(`sentences-container-${pageIndex}`);
			container.innerHTML = '';

			if (sentences.length === 0) {
				container.innerHTML = '<p>No sentences found for this page.</p>';
				return;
			}

			sentences.forEach((sentence, index) => {
				const sentenceElement = createSentenceElement(sentence, index, pageIndex);
				container.appendChild(sentenceElement);
			});
		}

		function createSentenceElement(sentence, index, pageIndex) {
			// Convert old format to new format if needed
			let timingValue = sentence.audio_timing || '';
			if (!timingValue && sentence.audio_start && sentence.audio_end) {
				timingValue = `${sentence.audio_start}, ${sentence.audio_end}`;
			} else if (!timingValue && sentence.audio_start) {
				timingValue = sentence.audio_start;
			}

			const div = document.createElement('div');
			div.className = 'sentence-item';
			div.innerHTML = `
                <div class="sentence-header">
                    <span class="sentence-number">Sentence ${index + 1}</span>
                    <div class="sentence-actions">
                        <button class="btn btn-danger" onclick="deleteSentence(this, ${pageIndex})">Delete</button>
                    </div>
                </div>
                <div class="sentence-content">
                    <label>Content:</label>
                    <textarea onchange="updateSentence(this, ${pageIndex})">${sentence.content || ''}</textarea>
                </div>
                <div class="sentence-timing">
                    <div class="timing-input">
                        <label>Timing (s):</label>
                        <input type="text" placeholder="e.g., 28, 32" value="${timingValue}" onchange="updateSentence(this, ${pageIndex})">
                    </div>
                </div>
                <div class="sentence-audio">
                    ${sentence.audio_url ? `
                        <button class="btn btn-primary play-btn" onclick="playAudioSegment('${sentence.audio_url}', this, ${pageIndex}, ${index})">
                            ▶ Play
                        </button>
                        <div class="audio-info" id="audio-info-${pageIndex}-${index}">
                            ${timingValue ? `Timing: ${timingValue}s` : 'No timing available'}
                        </div>
                    ` : '<span class="audio-info">No audio available</span>'}
                </div>
            `;
			return div;
		}

		function updateSentence(element, pageIndex) {
			const sentenceItem = element.closest('.sentence-item');
			const sentenceIndex = Array.from(sentenceItem.parentNode.children).indexOf(sentenceItem);

			// Update the sentence data
			const textareas = sentenceItem.querySelectorAll('textarea');
			const timingInput = sentenceItem.querySelector('input[type="text"]');

			bookData.pages[pageIndex].sentences[sentenceIndex].content = textareas[0].value;

			// Parse timing string and set both new and old fields
			const timingValue = timingInput.value;
			bookData.pages[pageIndex].sentences[sentenceIndex].audio_timing = timingValue;

			// Update audio info display
			const audioInfo = document.getElementById(`audio-info-${pageIndex}-${sentenceIndex}`);
			if (audioInfo) {
				audioInfo.textContent = timingValue ? `Timing: ${timingValue}s` : 'No timing available';
			}

			// Parse timing string to extract start and end values
			if (timingValue && timingValue.includes(',')) {
				const parts = timingValue.split(',').map(p => p.trim());
				bookData.pages[pageIndex].sentences[sentenceIndex].audio_start = parseFloat(parts[0]) || 0;
				bookData.pages[pageIndex].sentences[sentenceIndex].audio_end = parseFloat(parts[1]) || 0;
			} else if (timingValue) {
				bookData.pages[pageIndex].sentences[sentenceIndex].audio_start = parseFloat(timingValue) || 0;
				bookData.pages[pageIndex].sentences[sentenceIndex].audio_end = parseFloat(timingValue) || 0;
			} else {
				bookData.pages[pageIndex].sentences[sentenceIndex].audio_start = 0;
				bookData.pages[pageIndex].sentences[sentenceIndex].audio_end = 0;
			}

			// Mark as having changes for this page
			hasUnsavedChanges[pageIndex] = true;
			updatePageSaveButton(pageIndex);
		}

		function deleteSentence(button, pageIndex) {
			if (!confirm('Are you sure you want to delete this sentence?')) {
				return;
			}

			const sentenceItem = button.closest('.sentence-item');
			const sentenceIndex = Array.from(sentenceItem.parentNode.children).indexOf(sentenceItem);

			// Remove from bookData
			bookData.pages[pageIndex].sentences.splice(sentenceIndex, 1);

			// Remove from DOM
			sentenceItem.remove();

			// Mark as having changes for this page
			hasUnsavedChanges[pageIndex] = true;
			updatePageSaveButton(pageIndex);

			// Update sentence numbers for this page
			updateSentenceNumbersForPage(pageIndex);
		}


		function addNewSentence(pageIndex) {
			// Create new sentence object
			const newSentence = {
				content: '',
				translate: '',
				audio_timing: '',
				audio_start: 0,
				audio_end: 0,
				audio_url: ''
			};

			// Add to bookData
			bookData.pages[pageIndex].sentences.push(newSentence);

			// Create and add DOM element
			const sentenceElement = createSentenceElement(newSentence, bookData.pages[pageIndex].sentences.length - 1, pageIndex);
			const container = document.getElementById(`sentences-container-${pageIndex}`);
			container.appendChild(sentenceElement);

			// Mark as having changes for this page
			hasUnsavedChanges[pageIndex] = true;
			updatePageSaveButton(pageIndex);

			// Update sentence numbers for this page
			updateSentenceNumbersForPage(pageIndex);
		}

		function updateSentenceNumbersForPage(pageIndex) {
			const container = document.getElementById(`sentences-container-${pageIndex}`);
			const sentenceItems = container.querySelectorAll('.sentence-item');
			sentenceItems.forEach((item, index) => {
				const numberSpan = item.querySelector('.sentence-number');
				if (numberSpan) {
					numberSpan.textContent = `Sentence ${index + 1}`;
				}
			});
		}

		function updatePageSaveButton(pageIndex) {
			const saveBtn = document.getElementById(`save-btn-${pageIndex}`);
			// Always keep the button enabled
			saveBtn.disabled = false;
		}

		async function savePageChanges(pageIndex) {
			if (!hasUnsavedChanges[pageIndex]) {
				alert('No changes to save for this page');
				return;
			}

			try {
				const saveBtn = document.getElementById(`save-btn-${pageIndex}`);
				saveBtn.textContent = 'Saving...';

				const response = await fetch(`/api/book/update-sentences/${bookId}/${pageIndex}`, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify(bookData.pages[pageIndex].sentences)
				});

				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}

				// Update original sentences to reflect saved state
				originalSentences[pageIndex] = JSON.parse(JSON.stringify(bookData.pages[pageIndex].sentences));

				hasUnsavedChanges[pageIndex] = false;
				updatePageSaveButton(pageIndex);

				// Update saved pages count
				savedPagesCount++;

				// Show success feedback with alert
				alert(`Page ${pageIndex + 1} saved successfully! (${savedPagesCount} total saves)`);

				// Visual feedback on button
				saveBtn.textContent = '✓ Saved!';
				saveBtn.style.backgroundColor = '#28a745';
				saveBtn.style.transform = 'scale(1.1)';
				setTimeout(() => {
					saveBtn.textContent = 'Save Changes';
					saveBtn.style.backgroundColor = '#007bff';
					saveBtn.style.transform = 'scale(1)';
				}, 2000);

				// Add page-level success indicator
				const pageWrapper = saveBtn.closest('.page-wrapper');
				pageWrapper.style.border = '2px solid #28a745';
				pageWrapper.style.boxShadow = '0 0 10px rgba(40, 167, 69, 0.3)';
				setTimeout(() => {
					pageWrapper.style.border = '1px solid #ddd';
					pageWrapper.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
				}, 3000);

			} catch (error) {
				console.error('Error saving changes:', error);
				alert(`Failed to save changes for page ${pageIndex + 1}: ${error.message}`);
			} finally {
				const saveBtn = document.getElementById(`save-btn-${pageIndex}`);
				saveBtn.textContent = 'Save Changes';
			}
		}


		function showLoading(show) {
			document.getElementById('loading').classList.toggle('show', show);
		}

		function showError(message) {
			const container = document.getElementById('error-container');
			container.innerHTML = `<div class="error-message">${message}</div>`;
			setTimeout(() => {
				container.innerHTML = '';
			}, 5000);
		}

		function showSuccess(message) {
			const container = document.getElementById('success-container');
			container.innerHTML = `<div class="success-message">✅ ${message}</div>`;
			setTimeout(() => {
				container.innerHTML = '';
			}, 5000);
		}

		function goBack() {
			const hasAnyUnsavedChanges = Object.values(hasUnsavedChanges).some(hasChanges => hasChanges);
			if (hasAnyUnsavedChanges) {
				if (!confirm('You have unsaved changes. Are you sure you want to leave?')) {
					return;
				}
			}
			window.history.back();
		}

		// Warn before leaving with unsaved changes
		window.addEventListener('beforeunload', (e) => {
			const hasAnyUnsavedChanges = Object.values(hasUnsavedChanges).some(hasChanges => hasChanges);
			if (hasAnyUnsavedChanges) {
				e.preventDefault();
				e.returnValue = '';
			}
		});

		// Audio playback functions
		let currentAudio = null;

		function playAudioSegment(audioUrl, button, pageIndex, sentenceIndex) {
			// Get current timing value from the input field
			const sentenceItem = button.closest('.sentence-item');
			const timingInput = sentenceItem.querySelector('input[type="text"]');
			const timingValue = timingInput.value;

			console.log('Playing audio:', audioUrl, 'Timing:', timingValue);

			// Check if there's already an audio element for this sentence
			const audioId = `audio-${pageIndex}-${sentenceIndex}`;
			let audio = document.getElementById(audioId);

			// If this is the same audio that's currently playing, toggle pause/play
			if (currentAudio && currentAudio.id === audioId) {
				if (audio.paused) {
					audio.play();
					button.textContent = '⏸ Pause';
					button.classList.remove('btn-primary');
					button.classList.add('btn-secondary');
				} else {
					audio.pause();
					button.textContent = '▶ Play';
					button.classList.remove('btn-secondary');
					button.classList.add('btn-primary');
				}
				return;
			}

			// Stop any currently playing audio
			if (currentAudio) {
				currentAudio.pause();
				currentAudio.currentTime = 0;
				// Reset previous button
				const prevButtons = document.querySelectorAll('.play-btn');
				prevButtons.forEach(btn => {
					if (btn.nextElementSibling && btn.nextElementSibling.id === currentAudio.id) {
						btn.textContent = '▶ Play';
						btn.classList.remove('btn-secondary');
						btn.classList.add('btn-primary');
					}
				});
			}

			// Always create a new audio element to ensure fresh loading
			if (audio) {
				audio.remove();
			}
			audio = document.createElement('audio');
			audio.id = audioId;
			audio.style.display = 'none';
			audio.innerHTML = `<source src="/assets/${audioUrl}" type="audio/mpeg">`;
			button.parentNode.appendChild(audio);

			// Parse timing value
			let startTime = 0;
			let endTime = 0;

			if (timingValue && timingValue.trim()) {
				if (timingValue.includes(',')) {
					const parts = timingValue.split(',').map(p => p.trim());
					startTime = parseFloat(parts[0]) || 0;
					endTime = parseFloat(parts[1]) || 0;
				} else {
					startTime = parseFloat(timingValue) || 0;
					endTime = startTime + 5; // Default 5 second duration if only start time provided
				}
			} else {
				// If no timing value, play from beginning for 5 seconds
				startTime = 0;
				endTime = 5;
			}

			console.log('Parsed timing - Start:', startTime, 'End:', endTime);

			// Set up audio event listeners
			let hasStartedPlaying = false;

			function startPlayback() {
				if (hasStartedPlaying) return;
				hasStartedPlaying = true;

				console.log('Starting playback, setting time to:', startTime);
				audio.currentTime = startTime;
				// Small delay to ensure currentTime is set
				setTimeout(() => {
					audio.play();
					button.textContent = '⏸ Pause';
					button.classList.remove('btn-primary');
					button.classList.add('btn-secondary');
				}, 100);
			}

			audio.oncanplaythrough = startPlayback;
			audio.onloadeddata = startPlayback;

			audio.ontimeupdate = function () {
				if (audio.currentTime >= endTime) {
					audio.pause();
					audio.currentTime = startTime;
					button.textContent = '▶ Play';
					button.classList.remove('btn-secondary');
					button.classList.add('btn-primary');
					currentAudio = null;
				}
			};

			audio.onended = function () {
				button.textContent = '▶ Play';
				button.classList.remove('btn-secondary');
				button.classList.add('btn-primary');
				currentAudio = null;
			};

			audio.onpause = function () {
				if (audio.currentTime < endTime) {
					button.textContent = '▶ Play';
					button.classList.remove('btn-secondary');
					button.classList.add('btn-primary');
					currentAudio = null;
				}
			};

			audio.onerror = function (e) {
				console.error('Audio error:', e);
				showError('Failed to load audio file');
				button.textContent = '▶ Play';
				button.classList.remove('btn-secondary');
				button.classList.add('btn-primary');
				currentAudio = null;
			};

			// Set current audio reference
			currentAudio = audio;

			// Load and play
			audio.load();
		}

		// Initialize
		document.addEventListener('DOMContentLoaded', initializeApp);
	</script>
</body>

</html>